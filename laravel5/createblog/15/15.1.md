# 权限管理模块

# 分析设计

我们要实现一个权限管理，权限管理其实是一个大家以后工作中会经常遇到的问题，不同的人进来，能看到不同的功能。做不同的操作。其实一个权限功能的设计粒度是很重要的，就是你的权限管理的最小粒度有哪些，你可以管理到每个按钮，也可以管理到一个页面，也可以管理到一个模块。首先要明确的是，并不是粒度越小越好。粒度越小，说明你的设计越复杂，那么你的易用性就一定会打折扣的。一般来说，我们做基本的后台管理系统，按照模块分权限系统是基本能达到要求的。

看页面，我们按照左边栏分权限管理，我们设计“用户－角色－权限” 这样的模型，角色和权限是多对多的关系，用户和角色也是多对多的关系，一个用户可以有多个角色，一个角色包含多个权限。这样一个用户总共有的权限就是它身上所有角色包含起来的结果。

我们首先需要三个表，一个用户表，一个角色表，一个权限表。然后需要几个关系表，用户-角色表，角色-权限表。用户表我们已经有了，现在就是却少角色表，权限表，还有两张关系表。

# 表设计

## 表
// 演示：实现角色表，权限表，用户-角色表，角色-权限表。

## 模型

## 角色模型

* 一个用户有多个角色
* 一个用户是否有某个角色
* 给用户分配角色
* 给用户取消分配角色

## 权限模型

* 一个角色有多个权限
* 给角色分配权限
* 给角色取消权限
* 判断一个角色是否有某个权限
* 判断一个用户是否有某个权限

# 页面

## 路由

权限管理列表页／权限管理增加页／角色管理类列表页面／角色管理增加页／用户管理列表页面／用户管理增加页

## 权限管理页面

## 角色管理页面

## 用户管理页面

# 逻辑

## 权限管理列表／增加页面

## 角色管理列表／增加页面

## 用户管理列表／增加页面

# 权限管理应用

## laravel的Gate

laravel的Gate逻辑是认证逻辑的一部分，它的意思就是门卫，我们之前已经使用它来实现了Auth登陆的功能。现在我们要使用它来实现权限验证的功能。

Gate需要先注册，并且注册一个唯一的名字。比如这里，我们需要把我们数据库中的所有权限都进行注册。

其次是使用，Gate的使用有几种：

```
直接使用Gate：
Gate::forUser($user)->allows('update', $post)

使用User:
$user->can('update', $post)

路由中使用：
Route::put('/post/{post}', function (Post $post) {
    // 当前用户可以更新博客...
})->middleware('can:update,post');

控制器中使用：
class PostController extends Controller
{
    public function update(Request $request, Post $post)
    {
        $this->authorize('update', $post);

        // 当前用户可以更新博客...
    }
}

模版中使用：
@can('update', $post)
    <!-- 当前用户可以更新博客 -->
@elsecan('create', $post)
    <!-- 当前用户可以新建博客 -->
@endcan
```

我们这里会使用路由和模版中使用的方式。

我们在路由中需要限制哪些路由需要使用什么方法

我们在左边栏中显示哪些菜单

# 权限应用

## 注册Gate

我们在AuthProvider中进行Gate的注册

// 演示：AuthProvider注册

## 路由权限限制

然后我们在路由中使用Group将我们需要某个权限的路由给限制起来。

// 演示：路由中增加

## 左边栏

// 演示：左边栏增加
